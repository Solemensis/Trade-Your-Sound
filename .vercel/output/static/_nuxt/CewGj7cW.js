import{e as I}from"./TpeEdVKv.js";import{_ as S,i as V,j,r as u,x as R,l as h,q as U,c as i,d as n,g,u as e,F as T,z as w,t as c,w as z,v as D,A as E,m as F,n as M,o as l,B as q,e as A}from"./Czqr_EBs.js";import{_ as G}from"./CeupWUZ4.js";const H={style:{position:"relative"}},K={key:0,class:"container"},L={class:"left-part"},Q=["onClick"],J=["onClick"],X={key:0,"data-aos":"fade-out"},O={class:"right-part"},P={class:"heading-box"},W={key:1,class:"roomNameChat"},Y={class:"input-and-button"},Z={key:1,class:"errorMessage"},ee={key:2,class:"lds-dual-ring",style:{top:"35rem"}},se={__name:"chat",setup(te){const f=V(),N=j(),r=u([]);R(async()=>{setTimeout(async()=>{const{data:s,error:o,refresh:a,pending:k}=await h("/api/chatroom/fetchChats","$5GQtj1BVEU");k.value||(p.value=!1),!s.value&&o.value&&(o.value=null,a()),r.value=s.value},1)});const p=u(!0),y=u();async function b(s){const{data:o}=await h("/api/chatroom/fetchMessages",{method:"post",body:s.id},"$7DuzXsaBrG");p.value=!1,y.value=o.value,v.value=s.id,t.value=s,setTimeout(()=>{_&&_.value!=null&&_.value.scrollHeight&&(_.value.scrollTop=_.value.scrollHeight)},1),N.channel("any").on("postgres_changes",{event:"INSERT",schema:"public",table:"Messages"},async a=>{await b(s)}).subscribe()}const v=u(""),t=u({}),m=U("userName"),d=u("");async function C(){if(d.value!=""){const s={content:d.value,lister_id:f.value.id,room_id:v.value};d.value="",await h("/api/chatroom/postMessage",{method:"post",body:s},"$eIj21c66Jq")}}const _=u(null);async function $(s){v.value==s.id&&(v.value=""),await h("/api/chatroom/deleteChat",{method:"delete",body:{roomId:s.id,userId:f.value.id}},"$l7roi5ea2Q"),r.value=r.value.filter(o=>o.id!=s.id)}function x(s){M(`/profile/${s}`)}function B(){M(t.value.listing_path)}return(s,o)=>(l(),i("div",null,[n("div",H,[e(r)&&e(r).length?(l(),i("div",K,[n("div",L,[(l(!0),i(T,null,w(e(r),a=>(l(),i("div",{onClick:k=>b(a),key:a.id,class:"chatrooms"},[n("h3",null,c(a.room_name),1),n("img",{onClick:k=>$(a),src:G,alt:"delete button"},null,8,J)],8,Q))),128))]),e(v)?(l(),i("div",X,[n("div",O,[n("div",P,[n("p",{onClick:o[0]||(o[0]=a=>x(e(m)==e(t).user1_nick?e(t).user2_nick:e(t).user1_nick))},c(e(m)==e(t).user1_nick?e(t).user2_nick:e(t).user1_nick),1),e(t).listing_path?(l(),i("h2",{key:0,onClick:B,class:"roomNameListing"},c(e(t).room_name),1)):(l(),i("h2",W,c(e(t).room_name),1)),n("p",{onClick:o[1]||(o[1]=a=>x(e(m)==e(t).user1_nick?e(t).user1_nick:e(t).user2_nick))},c(e(m)==e(t).user1_nick?e(t).user1_nick:e(t).user2_nick),1)]),n("div",{ref_key:"messageBox",ref:_,class:"message-box"},[(l(!0),i(T,null,w(e(y),a=>(l(),i("p",{class:q(e(f).id==a.lister_id?"myMessage":"itsMessage"),key:a.id},[A(c(a.content)+" ",1),n("span",null,c(("extractTime"in s?s.extractTime:e(I))(a.created_at)),1)],2))),128))],512),n("div",Y,[z(n("input",{onKeydown:E(C,["enter"]),class:"text-input","onUpdate:modelValue":o[2]||(o[2]=a=>F(d)?d.value=a:null),type:"text",placeholder:"hi, i like your work! do you wanna collab for a project?"},null,544),[[D,e(d)]]),n("button",{class:"hero-button send-button",onClick:C}," Send ")])])])):g("",!0)])):!e(p)&&e(r)&&!e(r).length?(l(),i("h3",Z," No chat rooms. ")):g("",!0),e(p)?(l(),i("div",ee)):g("",!0)])]))}},ie=S(se,[["__scopeId","data-v-1fcaf2d3"]]);export{ie as default};
