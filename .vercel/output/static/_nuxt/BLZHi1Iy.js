import{_ as Y}from"./CjALhwT_.js";import{_ as y,c as d,o as i,a as I,u as l,b as q,r as h,d as t,t as _,e as b,f as H,g as T,n as M,h as D,i as N,j as R,k as P,l as w,w as L,v as B,m as U,p as V,q as F,s as J,x as j,y as W}from"./Czqr_EBs.js";import{c as A,g as X,r as Q,a as Z}from"./TpeEdVKv.js";import{u as G}from"./DKmlSW97.js";const K={class:"box"},ee={__name:"File",props:{audio:String},setup(o){const c=q();return(n,p)=>{const e=Y;return i(),d("div",K,[I(e,{src:`${l(c).public.supabase.url}/storage/v1/object/public/audios/${o.audio}`},null,8,["src"])])}}},te=y(ee,[["__scopeId","data-v-b18094f6"]]),ne={class:"category-processing"},oe={class:"name-box"},se={class:"listing-name"},ae={class:"creator-tag"},ie={class:"creator"},de={class:"created-updated"},le={class:"price-file-box"},ue={class:"price"},re={class:"description"},ce={__name:"Hero",props:{audio:Object},setup(o){const c=o;function n(){M(`/profile/${encodeURIComponent(c.audio.user_name)}`)}const p=h(!0);return(e,r)=>{const a=te;return i(),d("div",null,[t("p",ne,_(o.audio.category)+" | "+_(o.audio.processing),1),t("div",oe,[t("h2",se,_(o.audio.name),1),t("div",ae,[t("p",{class:"creator-box",onClick:n},[r[0]||(r[0]=b(" Created by: ",-1)),t("span",ie,_(o.audio.user_name),1)]),t("div",null,[t("p",de," Listed: "+_(("cutString"in e?e.cutString:l(A))(String(o.audio.created_at)))+" - Updated: "+_(("cutString"in e?e.cutString:l(A))(String(o.audio.updated_at))),1)])])]),t("div",null,[t("div",le,[t("p",ue,[r[1]||(r[1]=t("span",{class:"dollar-sign"},"$",-1)),b(_(o.audio.price),1)]),l(p)?(i(),H(a,{key:0,audio:o.audio.audio},null,8,["audio"])):T("",!0)]),t("p",re,_(o.audio.description),1)])])}}},pe=y(ce,[["__scopeId","data-v-c98ad9a7"]]),_e={style:{"text-align":"center"}},me={key:0},ge={key:0,style:{position:"relative"}},he={key:0,style:{color:"orangered",position:"absolute",bottom:"-3.5rem",left:"50%",transform:"translateX(-50%)","font-size":"1.2rem"}},fe={key:1,class:"user-buttons"},ve={key:1},$e={__name:"Buttons",props:{audio:Object},emits:["toggle-open"],setup(o,{emit:c}){const n=o,p=D(),e=N(),r=R(),a=P({room_name:"",user1_id:null,user2_id:null,user1_deleted:{},user2_deleted:{},user1_nick:"",user2_nick:"",listing_path:""}),s=h("");async function u(){const{data:v}=await w("/api/producerProfile/specificUser","$T4E5bYwLn0");if(!v.value||v.value&&v.value.description==!1){s.value="You need to fill your profile before sending messages.";return}a.room_name=`${n.audio.name} - $${n.audio.price}`,a.user1_id=e.value.id,a.user2_id=n.audio.lister_id,a.user1_deleted={userId:e.value.id,deleted:!1},a.user2_deleted={userId:n.audio.lister_id,deleted:!1},a.user1_nick=v.value.user_name,a.user2_nick=n.audio.user_name,a.listing_path=p.path;try{const $={room_name:a.room_name,user1_id:a.user1_id,user2_id:a.user2_id,user1_deleted:a.user1_deleted,user2_deleted:a.user2_deleted,user1_nick:a.user1_nick,user2_nick:a.user2_nick,listing_path:a.listing_path};a.user1_id==a.user2_id?s.value="You can't send message to yourself":(await w("/api/chatroom/createChat",{method:"post",body:$},"$AhCD8NyqP4"),M("/chat"))}catch{M("/chat")}}async function C(){await w(`/api/audio/listings/${n.audio.id}`,{method:"delete"},"$kqfqJYUXcd");const{error:v}=await r.storage.from("audios").remove([n.audio.audio]);M("/profile/listings")}const f=c;function S(){f("toggle-open",!0)}return(v,$)=>(i(),d("div",_e,[l(e)?(i(),d("div",me,[l(e).id!=n.audio.lister_id?(i(),d("div",ge,[t("button",{class:"hero-button",onClick:u},"Send Message"),l(s)?(i(),d("p",he,_(l(s)),1)):T("",!0)])):(i(),d("div",fe,[t("button",{class:"hero-button",onClick:S},"Edit listing"),t("button",{class:"delete-button",onClick:C}," Delete listing ")]))])):(i(),d("div",ve,[...$[0]||($[0]=[t("h3",{class:"no-user"},"You have to be a user to send a message.",-1)])]))]))}},be=y($e,[["__scopeId","data-v-2ae5967d"]]),ye={class:"label-and-input"},Se={style:{position:"absolute",left:"-2rem",top:"2.8rem",color:"#aaa"}},Ie={for:""},ke=["placeholder"],Ce={__name:"Name",props:{title:String,name:String,placeholder:String,data:String},emits:["changeInput"],setup(o,{emit:c}){const n=o,p=c,e=h(`${n.data}`),r=()=>{p("changeInput",e.value,n.name)};return(a,s)=>(i(),d("div",null,[t("div",ye,[t("span",Se,_(25-l(e).length),1),t("label",Ie,[b(_(o.title)+" ",1),s[1]||(s[1]=t("span",{class:"green-span"},"*",-1))]),L(t("input",{maxlength:"25",type:"text",placeholder:o.placeholder,"onUpdate:modelValue":s[0]||(s[0]=u=>U(e)?e.value=u:null),onInput:r},null,40,ke),[[B,l(e)]])])]))}},xe=y(Ce,[["__scopeId","data-v-6737334c"]]),we={class:"label-and-input"},Ee={for:""},Le=["placeholder"],Ue={__name:"Price",props:{title:String,name:String,placeholder:String,data:String},emits:["changeInput"],setup(o,{emit:c}){const n=o,p=c,e=h(`${n.data}`),r=()=>{p("changeInput",e.value,n.name)};return(a,s)=>(i(),d("div",we,[t("label",Ee,[b(_(o.title)+" ",1),s[1]||(s[1]=t("span",{class:"green-span"},"*",-1))]),L(t("input",{class:"price-input",type:"text",placeholder:o.placeholder,"onUpdate:modelValue":s[0]||(s[0]=u=>U(e)?e.value=u:null),onInput:r},null,40,Le),[[B,l(e)]])]))}},Me=y(Ue,[["__scopeId","data-v-f8f1745b"]]),Te={class:"label-and-input"},De={key:1,value:"sound-effects"},Re={key:2,value:"ui-sounds"},Be={key:3,value:"foley-sounds"},Fe={key:4,value:"dialogue"},Ae={disabled:"",key:5,value:"soundscapes"},Ne={disabled:"",key:6,value:"environmental-sounds"},Pe={__name:"Categories",props:{title:String,name:String,data:String},emits:["changeInput"],setup(o,{emit:c}){const n=o,p=c,e=h(`${n.data}`),r=()=>{p("changeInput",e.value,n.name)};return(a,s)=>(i(),d("div",Te,[t("label",null,[b(_(o.title)+" ",1),s[1]||(s[1]=t("span",{class:"green-span"},"*",-1))]),L(t("select",{onChange:r,"onUpdate:modelValue":s[0]||(s[0]=u=>U(e)?e.value=u:null)},[(i(),d("option",De,"Sound Effects")),(i(),d("option",Re,"UI Sounds")),(i(),d("option",Be,"Foley Sounds")),(i(),d("option",Fe,"Dialogue")),(i(),d("option",Ae,"Soundscapes")),(i(),d("option",Ne," Environmental Sounds "))],544),[[V,l(e)]])]))}},Ve=y(Pe,[["__scopeId","data-v-c669b7de"]]),je={class:"label-and-input"},ze={for:""},Oe={key:1,value:"raw"},Ye={key:2,value:"edited"},qe={key:3,value:"mastered"},He={__name:"Processing",props:{title:String,name:String,data:String},emits:["changeInput"],setup(o,{emit:c}){const n=o,p=c,e=h(`${n.data}`),r=()=>{p("changeInput",e.value,n.name)};return(a,s)=>(i(),d("div",je,[t("label",ze,[b(_(o.title)+" ",1),s[1]||(s[1]=t("span",{class:"green-span"},"*",-1))]),L(t("select",{onChange:r,"onUpdate:modelValue":s[0]||(s[0]=u=>U(e)?e.value=u:null)},[(i(),d("option",Oe,"Raw")),(i(),d("option",Ye,"Edited")),(i(),d("option",qe,"Mastered"))],544),[[V,l(e)]])]))}},Je=y(He,[["__scopeId","data-v-481f64b2"]]),We={class:"label-and-input"},Xe={style:{display:"flex",gap:"1rem"}},Qe={for:""},Ze={style:{position:"absolute",left:"1rem",color:"#aaa"}},Ge=["placeholder"],Ke={__name:"Description",props:{title:String,name:String,placeholder:String,data:String},emits:["changeInput"],setup(o,{emit:c}){const n=o,p=c,e=h(`${n.data}`),r=()=>{p("changeInput",e.value,n.name)};return(a,s)=>(i(),d("div",We,[t("div",Xe,[t("label",Qe,[b(_(o.title)+" ",1),s[1]||(s[1]=t("span",{class:"green-span"},"*",-1))]),t("span",Ze,_(550-l(e).length),1)]),L(t("textarea",{maxlength:"550",type:"text",placeholder:o.placeholder,"onUpdate:modelValue":s[0]||(s[0]=u=>U(e)?e.value=u:null),onInput:r},null,40,Ge),[[B,l(e)]])]))}},et=y(Ke,[["__scopeId","data-v-7369e9db"]]),tt={class:"input-box"},nt={for:""},ot={class:"input"},st={key:0},at={key:1,style:{color:"#3fcf8e"}},it={key:0,style:{top:"-5rem","white-space":"nowrap"}},dt={style:{"font-size":"1.1rem",color:"orangered"}},lt={__name:"File",props:{data:String,title:String},emits:["changeInput"],async setup(o,{emit:c}){let n,p;const e=o,r=F("audioAudio",()=>({audio:null})),a=c;function s(g){return g.startsWith("public/")?g.substring(7):g}const u=h(s(e.data)),C=g=>{const m=g.target;if(m.files){if(m.files[0].type!="audio/mpeg"){f.value="For now, we can only accept mp3 files.",setTimeout(()=>{f.value=""},4e3);return}const E=new Audio;E.addEventListener("loadedmetadata",()=>{E.duration>=30?(f.value="For now, you can't upload an audio longer than 30 seconds.",setTimeout(()=>{f.value=""},4e3)):(r.value.audio=m.files[0],a("changeInput",m.files[0],"audio"),u.value=m.files[0].name,f.value="")}),E.src=URL.createObjectURL(m.files[0])}},f=h(""),S=R(),{data:v,error:$}=([n,p]=J(()=>S.storage.from("audios").download(e.data)),n=await n,p(),n);let k=new File([v],s(e.data),{type:"audio/mpeg"});const x=h(null);return j(()=>{const g=new DataTransfer;g.items.add(k),x.value.files=g.files,r.value.audio=g.files[0],a("changeInput",g.files[0],"audio")}),(g,m)=>(i(),d("div",tt,[t("label",nt,[b(_(o.title),1),m[0]||(m[0]=t("span",{class:"green-span"}," *",-1))]),t("div",ot,[t("input",{type:"file",accept:"audio/mpeg",style:{height:"100%",width:"100%",opacity:"0","z-index":"100"},onChange:C,ref_key:"fileinput",ref:x,title:""},null,544),t("div",null,[l(u)?(i(),d("p",at,[b(_(("getContentBeforeUnderscore"in g?g.getContentBeforeUnderscore:l(X))(l(u)))+" ",1),m[1]||(m[1]=t("br",null,null,-1)),m[2]||(m[2]=b("is placed. ",-1))])):(i(),d("p",st,"+ drop audio..."))]),l(f)?(i(),d("div",it,[t("p",dt,_(l(f)),1)])):T("",!0)])]))}},ut=y(lt,[["__scopeId","data-v-f1499cd8"]]),rt={class:"box"},ct={class:"youre-editing"},pt={class:"green-span"},_t={class:"inputs-group"},mt={key:0,style:{position:"absolute",bottom:"-3rem",color:"orangered","font-size":"1.2rem"}},gt={__name:"ListingEditMode",props:{audio:Object},emits:["toggle-close"],setup(o,{emit:c}){const n=o,p=N(),e=R(),r=D(),a=P({name:`${n.audio.name}`,price:`${n.audio.price}`,category:`${n.audio.category}`,processing:`${n.audio.processing}`,description:`${n.audio.description}`,audio:null}),s=h(""),u=($,k)=>{a[k]=$};async function C(){const $=Q(a.name)+"_"+Z(new Date)+"_"+Math.floor(Math.random()*999),{data:k,error:x}=await e.storage.from("audios").upload("public/"+$,a.audio);if(x)return s.value="Cannot upload audio";if(p.value.id===n.audio.lister_id){const g={name:a.name,price:parseInt(a.price),category:a.category,processing:a.processing,description:a.description,lister_id:p.value.id,audio:k.path},{error:m}=await w(`/api/audio/listings/${r.params.id}/`,{method:"put",body:g},"$z2Lv6B0MEC");if(m.value){s.value=m.value.statusMessage,await e.storage.from("audios").remove(k.path);return}await e.storage.from("audios").remove(n.audio.audio),S(),v.value=!v.value}else return}const f=c;function S(){f("toggle-close",!1)}const v=F("listingEditRefetchSignal",()=>!1);return($,k)=>{const x=xe,g=Me,m=Ve,E=Je,z=et,O=ut;return i(),d("div",rt,[t("h2",ct,[k[0]||(k[0]=b(" You're editing ",-1)),t("span",pt,'"'+_(o.audio.name)+'"',1)]),t("div",_t,[I(x,{title:"Listing Name",name:"name",placeholder:"Fireball Sound",data:o.audio.name,onChangeInput:u},null,8,["data"]),I(g,{title:"Price",name:"price",placeholder:"5",data:String(o.audio.price),onChangeInput:u},null,8,["data"]),I(m,{title:"Category",name:"category",data:o.audio.category,onChangeInput:u,class:"categories"},null,8,["data"]),I(E,{title:"Processing",name:"processing",data:o.audio.processing,onChangeInput:u,class:"processing"},null,8,["data"]),I(z,{title:"Description",name:"description",placeholder:"When a beautiful fireball erupted, I pressed record and captured its deep rumble and sharp crack perfectly. Back in my studio, I spent hours editing and mastering the recording to ensure it sounded just as incredible on the recording as it did in the forest.",data:o.audio.description,onChangeInput:u,class:"description"},null,8,["data"]),I(O,{title:"Audio",data:o.audio.audio,onChangeInput:u,class:"file"},null,8,["data"])]),t("div",null,[t("div",{class:"buttons"},[t("button",{class:"hero-button",onClick:C},"Submit"),t("button",{class:"delete-button",onClick:S},"Cancel")]),l(s)?(i(),d("p",mt,_(l(s)),1)):T("",!0)])])}}},ht=y(gt,[["__scopeId","data-v-b777ca42"]]),ft={class:"container"},vt={key:0},$t={key:0},bt={key:1,"data-aos":"fade-in","data-aos-offset":"-2000","data-aos-duration":"1500"},yt={key:1,class:"lds-dual-ring"},St={__name:"[name]-[id]",setup(o){const c=D();G({title:c.params.name});const n=h({});j(async()=>{setTimeout(async()=>{const{data:a,error:s,refresh:u}=await w(`/api/audio/${c.params.id}`,"$Q4fJevd85D");!a.value&&s.value&&(s.value=null,u()),n.value=a.value},1)});const p=F("listingEditRefetchSignal");W(()=>p.value,async()=>{const{data:a}=await w(`/api/audio/${c.params.id}`,"$Zs78z2Orrd");n.value=a.value,e.value=!e.value,setTimeout(()=>{e.value=!e.value},300)});const e=h(!0),r=h(!1);return(a,s)=>{const u=pe,C=be,f=ht;return i(),d("div",ft,[l(n)&&l(n).name?(i(),d("div",vt,[l(r)?(i(),d("div",bt,[I(f,{audio:l(n),onToggleClose:s[1]||(s[1]=S=>r.value=S)},null,8,["audio"])])):(i(),d("div",$t,[I(u,{style:{},audio:l(n)},null,8,["audio"]),I(C,{audio:l(n),onToggleOpen:s[0]||(s[0]=S=>r.value=S)},null,8,["audio"])]))])):(i(),d("div",yt))])}}},wt=y(St,[["__scopeId","data-v-a94cb18a"]]);export{wt as default};
